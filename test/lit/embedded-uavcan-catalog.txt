# RUN: %dsdlc --target-language mlir %S/fixtures_embedded_uavcan/demo 2>/dev/null | FileCheck %s --check-prefix=MLIR_EMBEDDED
# RUN: rm -rf %t.c && %dsdlc --target-language c %S/fixtures_embedded_uavcan/demo --outdir %t.c >/dev/null 2>&1
# RUN: test -f %t.c/demo/UsesHeartbeat_1_0.h
# RUN: test -f %t.c/uavcan/node/Heartbeat_1_0.h
# RUN: %dsdlc --target-language c --list-inputs %S/fixtures_embedded_uavcan/demo 2>/dev/null | FileCheck %s --check-prefix=LIST_INPUTS
# RUN: rm -rf %t.md && %dsdlc --target-language c -MD --outdir %t.md %S/fixtures_embedded_uavcan/demo >/dev/null 2>&1
# RUN: cat %t.md/demo/UsesHeartbeat_1_0.h.d | FileCheck %s --check-prefix=DEPFILE_LOCAL
# RUN: rm -rf %t.noembed && mkdir -p %t.noembed/demo %t.noembed/uavcan/node
# RUN: cp %S/fixtures_embedded_uavcan/demo/UsesHeartbeat.1.0.dsdl %t.noembed/demo/UsesHeartbeat.1.0.dsdl
# RUN: printf "@sealed\n" > %t.noembed/uavcan/node/Heartbeat.1.0.dsdl
# RUN: rm -rf %t.noembed.out && %dsdlc --target-language c -MD --no-embedded-uavcan --lookup-dir %t.noembed/demo --lookup-dir %t.noembed/uavcan %t.noembed/demo/UsesHeartbeat.1.0.dsdl --outdir %t.noembed.out >/dev/null 2>&1
# RUN: cat %t.noembed.out/demo/UsesHeartbeat_1_0.h.d | FileCheck %s --check-prefix=DEPFILE_NO_EMBED
# RUN: cat %t.noembed.out/uavcan/node/Heartbeat_1_0.h.d | FileCheck %s --check-prefix=DEPFILE_NO_EMBED_HEARTBEAT
# RUN: not %dsdlc --target-language c --no-embedded-uavcan %S/fixtures_embedded_uavcan/demo --outdir %t.no 2>&1 | FileCheck %s --check-prefix=NO_EMBEDDED_FAIL

# MLIR_EMBEDDED: full_name = "demo.UsesHeartbeat"
# MLIR_EMBEDDED: full_name = "uavcan.node.Heartbeat"

# LIST_INPUTS: UsesHeartbeat.1.0.dsdl
# LIST_INPUTS-NOT: embedded-uavcan

# DEPFILE_LOCAL: UsesHeartbeat.1.0.dsdl
# DEPFILE_LOCAL-NOT: embedded-uavcan

# DEPFILE_NO_EMBED: UsesHeartbeat_1_0.h:
# DEPFILE_NO_EMBED: UsesHeartbeat.1.0.dsdl
# DEPFILE_NO_EMBED: Heartbeat.1.0.dsdl
# DEPFILE_NO_EMBED-NOT: embedded-uavcan

# DEPFILE_NO_EMBED_HEARTBEAT: Heartbeat_1_0.h:
# DEPFILE_NO_EMBED_HEARTBEAT: Heartbeat.1.0.dsdl
# DEPFILE_NO_EMBED_HEARTBEAT-NOT: UsesHeartbeat.1.0.dsdl

# NO_EMBEDDED_FAIL: unresolved composite type: uavcan.node.Heartbeat.1.0
